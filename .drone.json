{
  kind: "pipeline"
  name: "default"
  steps: [
    {
      name: "Lint code",
      image: "quay.io/ansible/molecule",
      commands: [
        "molecule lint",
        "molecule syntax"
      ]
    }
  ]
}

local Pipeline(distro) = {
  kind: "pipeline",
  steps: [
    {
      name: "Converge and verify - "+distro,
      image: "quay.io/ansible/molecule",
      commands: [
        "molecule cleanup",
        "molecule destroy",
        "molecule create",
        "molecule converge",
        "molecule idempotence",
        "molecule verify",
        "molecule cleanup",
      ],
      privileged: "true"
      volumes: [
        name: "docker",
        path: "/var/run/docker.sock",
      ],
    }
  ]
};

[
    Pipeline("debian9"),
    Pipeline("debian8"),
    Pipeline("centos7"),
    Pipeline("centos6"),
    Pipeline("ubuntu1804"),
    Pipeline("ubuntu1604")
]

volumes:
  - name: 'docker'
    host:
      path: '/var/run/docker.sock'

